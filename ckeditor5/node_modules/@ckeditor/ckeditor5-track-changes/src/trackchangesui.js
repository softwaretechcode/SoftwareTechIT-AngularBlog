/*
 *             Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x384c=['_suggestionToController','acceptSelectedSuggestions','destroy','Track\x20changes','separator','_disableComments','TrackChangesUI','comments','_viewToController','button','SuggestionThreadView','value','clear','suggestionLoaded','listenTo','registerAnnotation','discardAllSuggestions','commandName','filter','getSuggestion','getMarkers','delete','config','commentThread','discardButton','has','innerView','model','lowest','activeAnnotations','comments.maxThreadTotalWeight','EditorAnnotations','set','keys','define','init','CommentView','add','isInContent','actionView','_initializeController','Annotations','_annotationViews','stopListening','editor','CommentsRepository','trackChanges.disableComments','switchbutton','_refreshActiveMarkers','commands','reduce','trackChanges','TrackChangesEditing','isDirty','Accept\x20all\x20selected\x20suggestions','hasSuggestion','pluginName','remove','size','requires','plugins','getJoined','view','_handleSuggestionControllerDelayed','Discard\x20all\x20selected\x20suggestions','isOn','type','length','get','descriptionParts','isEnabled','editing','acceptAllSuggestions','unbind','_handleControllerBuffer','_descriptionFactory','createAnnotation','activeMarkers','mainView','_updateController','map','refreshSelectedViews','suggestionChanged','componentFactory','getDescriptions','createCommentThreadController','_bindAnnotationToEditors','acceptButton','change:previous','previous','comments.editorConfig','Discard\x20all\x20suggestions','locale','getRanges','bind','_createUIButton','trackChanges.SuggestionThreadView','values','push','comments.maxCommentsWhenCollapsed','execute','addSourceCollector','_destroyController','toMany','head','focus','buttonView','arrowView','suggestionUnloaded','getAllAdjacentSuggestions','discardSelectedSuggestions','isMultiRange','getFirstRange','suggestion-','from','some'];(function(_0xe12b4f,_0x384ccc){const _0x2f584b=function(_0xca69c6){while(--_0xca69c6){_0xe12b4f['push'](_0xe12b4f['shift']());}};_0x2f584b(++_0x384ccc);}(_0x384c,0x9f));const _0x2f58=function(_0xe12b4f,_0x384ccc){_0xe12b4f=_0xe12b4f-0x0;let _0x2f584b=_0x384c[_0xe12b4f];return _0x2f584b;};import{Plugin as _0x352bc5}from'ckeditor5/src/core';import{Collection as _0x56b27d}from'ckeditor5/src/utils';import{Model as _0xf1cec8,SplitButtonView as _0x267fb8,createDropdown as _0x238ea0,addListToDropdown as _0x4db84a}from'ckeditor5/src/ui';import{Users as _0x32a995,getDateTimeFormatter as _0x570f7c,getAllMarkersDomElementsSorted as _0x42ea1f}from'ckeditor5-collaboration/src/collaboration-core';import _0x40c609 from'./trackchangesediting';import _0x2fd209 from'./ui/suggestioncontroller';import _0xc7883f from'./ui/view/suggestionthreadview';import{getTranslation as _0x4d7042}from'./utils/common-translations';import _0x24f261 from'../theme/icons/track-changes.svg';export default class d extends _0x352bc5{static get[_0x2f58('0x10')](){return[_0x40c609,_0x32a995,_0x2f58('0x2'),_0x2f58('0x72'),_0x2f58('0x68')];}static get[_0x2f58('0xd')](){return _0x2f58('0x4f');}constructor(_0x1d19ff){super(_0x1d19ff),this['_suggestionToController']=new Map(),this[_0x2f58('0x51')]=new Map(),this[_0x2f58('0x73')]=new Map(),this[_0x2f58('0x1f')]=new Map();const _0x10f5ac=this[_0x2f58('0x1')][_0x2f58('0x5f')];_0x10f5ac[_0x2f58('0x6b')](_0x2f58('0x35'),_0xc7883f),_0x10f5ac[_0x2f58('0x6b')](_0x2f58('0x3'),!0x1),this[_0x2f58('0x4e')]=_0x10f5ac[_0x2f58('0x19')](_0x2f58('0x3'));}['_handleSuggestionControllerDelayed'](_0x92d7a5,_0x9fcdef){0x0===this[_0x2f58('0x1f')][_0x2f58('0xf')]&&setTimeout(()=>{for(const [_0xcec82b,_0x55b5b9]of this[_0x2f58('0x1f')]){const _0x120bdd=this[_0x2f58('0x49')][_0x2f58('0x62')](_0xcec82b);_0x120bdd||_0x55b5b9?_0x120bdd&&_0x55b5b9&&this['_destroyController'](_0xcec82b):this['_initializeController'](_0xcec82b);}this[_0x2f58('0x1')]['plugins'][_0x2f58('0x19')](_0x2f58('0x68'))[_0x2f58('0x26')](),this[_0x2f58('0x5')](),this[_0x2f58('0x1f')][_0x2f58('0x55')]();},0xa),this[_0x2f58('0x1f')]['set'](_0x92d7a5,_0x9fcdef);}[_0x2f58('0x6c')](){const _0x36edf6=this['editor'],_0x1499d4=_0x36edf6[_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x9')),_0x2aac33=_0x36edf6[_0x2f58('0x11')][_0x2f58('0x19')]('Annotations'),_0x924406=_0x36edf6[_0x2f58('0x11')]['get'](_0x2f58('0x68')),_0x3b0ed9=_0x36edf6[_0x2f58('0x11')][_0x2f58('0x19')]('CommentsRepository');_0x36edf6['ui'][_0x2f58('0x28')][_0x2f58('0x6e')](_0x2f58('0x8'),_0x2feab1=>this[_0x2f58('0x34')](_0x2feab1)),_0x924406[_0x2f58('0x3a')](()=>{const _0xbf56e6=[];for(const [_0x1c2416,_0xd38811]of Array[_0x2f58('0x47')](this[_0x2f58('0x49')])){const _0x1e7cb5=_0x1c2416[_0x2f58('0x42')](),_0x4e871a=[];for(const _0x14ffd0 of _0x1e7cb5){if(!_0x14ffd0['isInContent'])continue;if(_0x14ffd0[_0x2f58('0x44')]){_0x4e871a[_0x2f58('0x37')](..._0x14ffd0[_0x2f58('0x32')]());continue;}const _0x487bfd=_0x14ffd0[_0x2f58('0x45')]();if(_0x4e871a[_0x2f58('0x18')]>0x0){const _0xf8a29=_0x4e871a[0x0][_0x2f58('0x12')](_0x487bfd);if(_0xf8a29){_0x4e871a[0x0]=_0xf8a29;continue;}}_0x4e871a[_0x2f58('0x37')](_0x487bfd);}_0xbf56e6[_0x2f58('0x37')]([_0xd38811['view'],_0x4e871a]);}return _0xbf56e6;}),this[_0x2f58('0x57')](_0x1499d4,_0x2f58('0x56'),(_0x400a8b,_0x220501)=>{this[_0x2f58('0x57')](_0x220501,_0x2f58('0x2d'),(_0x3143db,_0x2e22b7,_0x31c91b,_0x3fa04b)=>{_0x220501[_0x2f58('0x6f')]&&(null==_0x31c91b?(this[_0x2f58('0x24')](_0x3fa04b['head']),this[_0x2f58('0x14')](_0x220501,!0x1)):(this[_0x2f58('0x24')](_0x31c91b[_0x2f58('0x3d')]),this[_0x2f58('0x14')](_0x220501,!0x0)));}),null===_0x220501[_0x2f58('0x2e')]?this[_0x2f58('0x14')](_0x220501,!0x1):this[_0x2f58('0x24')](_0x220501[_0x2f58('0x3d')]);}),this[_0x2f58('0x57')](_0x1499d4,_0x2f58('0x41'),(_0x119e22,_0x53d92a,_0x1274ee)=>{this[_0x2f58('0x0')](_0x53d92a,'change:previous'),this['_handleControllerBuffer'][_0x2f58('0x5e')](_0x53d92a);const _0x4a0d46=_0x1274ee?_0x1274ee[_0x2f58('0x3d')]:_0x53d92a,_0x21baa5=this['_suggestionToController'][_0x2f58('0x19')](_0x4a0d46);null!==_0x1274ee&&this[_0x2f58('0x24')](_0x4a0d46),null===_0x1274ee&&_0x21baa5&&this[_0x2f58('0x3b')](_0x53d92a);}),this[_0x2f58('0x57')](_0x1499d4,_0x2f58('0x27'),(_0x3a36d2,_0x25b856)=>{this[_0x2f58('0x24')](_0x25b856);}),this[_0x2f58('0x57')](_0x2aac33,'change:activeAnnotations',()=>{this[_0x2f58('0x5')]();}),this[_0x2f58('0x57')](_0x3b0ed9,'addComment',(_0x392348,{threadId:_0x5e32e6,isFromAdapter:_0x7743fb})=>{if(_0x7743fb||!_0x1499d4[_0x2f58('0xc')](_0x5e32e6))return;const _0x1d4fa4=_0x1499d4[_0x2f58('0x5c')](_0x5e32e6);this['_suggestionToController']['get'](_0x1d4fa4)[_0x2f58('0x13')][_0x2f58('0x3e')]();},{'priority':_0x2f58('0x65')});}[_0x2f58('0x5')](){const _0x1cb937=this['editor'][_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x72')),_0x31a986=this['editor'][_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x9')),_0x5202ae=Array[_0x2f58('0x47')](_0x1cb937[_0x2f58('0x66')],_0xa32b67=>_0xa32b67[_0x2f58('0x63')])[_0x2f58('0x5b')](_0x3fdefb=>this['_viewToController'][_0x2f58('0x62')](_0x3fdefb)),_0x178377=[];for(const _0x6997ce of _0x5202ae){const _0x389e63=this[_0x2f58('0x51')][_0x2f58('0x19')](_0x6997ce)['model'][_0x2f58('0x42')]();_0x178377[_0x2f58('0x37')](..._0x389e63[_0x2f58('0x7')]((_0x4156fa,_0x2c8156)=>[..._0x4156fa,..._0x2c8156['getMarkerNames']()],[]));}_0x31a986[_0x2f58('0x22')]=_0x178377;}[_0x2f58('0x34')](_0x9dd5a1){const _0x508906=_0x238ea0(_0x9dd5a1,_0x267fb8),_0x4889a8=this[_0x2f58('0x1')][_0x2f58('0x6')]['get'](_0x2f58('0x8')),_0x5b5190=_0x4d7042(_0x9dd5a1,_0x2f58('0x4c'));_0x508906['buttonView'][_0x2f58('0x69')]({'tooltip':_0x5b5190,'label':_0x5b5190,'icon':_0x24f261}),_0x508906[_0x2f58('0x3f')][_0x2f58('0x33')](_0x2f58('0x16'))['to'](_0x4889a8,_0x2f58('0x54')),_0x508906[_0x2f58('0x3f')]['on'](_0x2f58('0x39'),()=>{_0x4889a8[_0x2f58('0x39')](),this[_0x2f58('0x1')][_0x2f58('0x1c')][_0x2f58('0x13')][_0x2f58('0x3e')]();});const _0x1a7883=new _0x56b27d(),_0x1cb9a6=[{'type':_0x2f58('0x4'),'model':{'withText':!0x0,'label':_0x5b5190,'commandName':_0x2f58('0x8')}},{'type':_0x2f58('0x4d')},{'type':_0x2f58('0x52'),'model':{'withText':!0x0,'label':_0x4d7042(_0x9dd5a1,'Accept\x20all\x20suggestions'),'commandName':_0x2f58('0x1d')}},{'type':_0x2f58('0x52'),'model':{'withText':!0x0,'label':_0x4d7042(_0x9dd5a1,_0x2f58('0xb')),'commandName':_0x2f58('0x4a')}},{'type':'button','model':{'withText':!0x0,'label':_0x4d7042(_0x9dd5a1,_0x2f58('0x30')),'commandName':_0x2f58('0x59')}},{'type':_0x2f58('0x52'),'model':{'withText':!0x0,'label':_0x4d7042(_0x9dd5a1,_0x2f58('0x15')),'commandName':_0x2f58('0x43')}}];for(const _0x1df81a of _0x1cb9a6){let _0x1ce192={'type':_0x2f58('0x4d')};if(_0x1df81a[_0x2f58('0x64')]){const _0x5e4517=new _0xf1cec8(_0x1df81a[_0x2f58('0x64')]),_0x2cca1d=this['editor'][_0x2f58('0x6')][_0x2f58('0x19')](_0x5e4517[_0x2f58('0x5a')]);_0x5e4517[_0x2f58('0x33')](_0x2f58('0x16'),_0x2f58('0x1b'))['to'](_0x2cca1d,'value',_0x2f58('0x1b')),_0x1ce192={'type':_0x1df81a[_0x2f58('0x17')],'model':_0x5e4517};}_0x1a7883['add'](_0x1ce192);}_0x4db84a(_0x508906,_0x1a7883);const _0x51eae4=_0x1cb9a6[_0x2f58('0x5b')](_0xd07a55=>null!=_0xd07a55[_0x2f58('0x64')])[_0x2f58('0x25')](_0x4e7baf=>this[_0x2f58('0x1')][_0x2f58('0x6')][_0x2f58('0x19')](_0x4e7baf[_0x2f58('0x64')]['commandName'])),_0x169135=_0x508906['buttonView'];return _0x169135['actionView'][_0x2f58('0x1e')](_0x2f58('0x1b')),_0x169135[_0x2f58('0x40')][_0x2f58('0x1e')](_0x2f58('0x1b')),_0x169135[_0x2f58('0x70')][_0x2f58('0x33')](_0x2f58('0x1b'))['to'](_0x4889a8,'isEnabled'),_0x169135[_0x2f58('0x40')]['bind'](_0x2f58('0x1b'))[_0x2f58('0x3c')](_0x51eae4,_0x2f58('0x1b'),(..._0x4cf9a0)=>_0x4cf9a0[_0x2f58('0x48')](_0x177677=>_0x177677)),_0x508906['on'](_0x2f58('0x39'),_0x27d77b=>{this[_0x2f58('0x1')][_0x2f58('0x39')](_0x27d77b['source'][_0x2f58('0x5a')]),this[_0x2f58('0x1')][_0x2f58('0x1c')][_0x2f58('0x13')][_0x2f58('0x3e')]();}),_0x508906;}[_0x2f58('0x71')](_0x87eb07){const _0x469882=this[_0x2f58('0x1')],_0x6ddc1b=_0x469882[_0x2f58('0x5f')],_0x51b615=_0x469882[_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x72')),_0x2e131e=_0x469882[_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x2')),_0x5dd44e=_0x469882[_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x68')),_0x5f1d70=_0x469882[_0x2f58('0x11')][_0x2f58('0x19')](_0x32a995)['me'],_0x581c50=_0x6ddc1b[_0x2f58('0x19')](_0x2f58('0x8'))[_0x2f58('0x53')],{CommentsListView:_0x37d678,CommentThreadInputView:_0x5087ce}=_0x469882[_0x2f58('0x11')]['get']('CommentsUI');let _0x1accf3,_0x874de8;this[_0x2f58('0x73')]['has'](_0x87eb07['id'])?(_0x874de8=this[_0x2f58('0x73')][_0x2f58('0x19')](_0x87eb07['id']),_0x1accf3=_0x874de8['mainView']):(_0x1accf3=new _0x581c50(_0x469882[_0x2f58('0x31')],_0x87eb07,_0x5f1d70,{'disableComments':this[_0x2f58('0x4e')],'editorConfig':_0x6ddc1b[_0x2f58('0x19')](_0x2f58('0x2f')),'maxCommentsWhenCollapsed':_0x6ddc1b[_0x2f58('0x19')](_0x2f58('0x38')),'maxThreadTotalWeight':_0x6ddc1b['get'](_0x2f58('0x67')),'maxCommentCharsWhenCollapsed':_0x6ddc1b[_0x2f58('0x19')]('comments.maxCommentCharsWhenCollapsed'),'formatDateTime':_0x570f7c(_0x6ddc1b[_0x2f58('0x19')](_0x2f58('0x31'))),'CommentView':_0x6ddc1b[_0x2f58('0x19')](_0x2f58('0x50'))[_0x2f58('0x6d')],'CommentsListView':_0x37d678,'CommentThreadInputView':_0x5087ce}),_0x1accf3[_0x2f58('0x2c')]['on'](_0x2f58('0x39'),()=>{_0x469882['editing'][_0x2f58('0x13')][_0x2f58('0x3e')]();}),_0x1accf3[_0x2f58('0x61')]['on']('execute',()=>{_0x469882[_0x2f58('0x1c')][_0x2f58('0x13')][_0x2f58('0x3e')]();}),_0x874de8=_0x51b615['createAnnotationView'](this[_0x2f58('0x1')][_0x2f58('0x31')],_0x1accf3),_0x874de8[_0x2f58('0x33')](_0x2f58('0xa'))['to'](_0x1accf3,_0x2f58('0xa')),_0x874de8['bind']('length')['to'](_0x1accf3),_0x874de8[_0x2f58('0x33')]('type')['to'](_0x1accf3,_0x2f58('0x17'),_0x5c27a7=>_0x2f58('0x46')+_0x5c27a7),this[_0x2f58('0x73')][_0x2f58('0x69')](_0x87eb07['id'],_0x874de8));const _0x2af094=_0x2e131e[_0x2f58('0x2a')](_0x87eb07[_0x2f58('0x60')],_0x1accf3),_0x1ebfc3=new _0x2fd209(_0x469882,_0x87eb07,_0x1accf3,_0x2af094),_0x305a39=_0x87eb07[_0x2f58('0x42')]()['filter'](_0x15ecbf=>_0x15ecbf[_0x2f58('0x6f')]);_0x1accf3[_0x2f58('0x1a')]=_0x469882[_0x2f58('0x11')]['get'](_0x2f58('0x9'))['_descriptionFactory'][_0x2f58('0x29')](_0x305a39),this[_0x2f58('0x49')][_0x2f58('0x69')](_0x87eb07,_0x1ebfc3),this[_0x2f58('0x51')][_0x2f58('0x69')](_0x1accf3,_0x1ebfc3);const _0x44687c=_0x51b615[_0x2f58('0x21')]({'view':_0x874de8,'target':()=>{const _0x3c65d2=[],_0x1aa527=_0x87eb07['getAllAdjacentSuggestions']()[_0x2f58('0x5b')](_0x410500=>_0x410500[_0x2f58('0x6f')]);for(const _0x32c0c7 of _0x1aa527)_0x3c65d2['push'](..._0x32c0c7[_0x2f58('0x5d')]());return _0x42ea1f(_0x469882[_0x2f58('0x1c')],_0x3c65d2);},'type':()=>_0x2f58('0x46')+_0x1ebfc3['view'][_0x2f58('0x17')]});_0x2e131e[_0x2f58('0x2b')](_0x1accf3,_0x44687c),_0x51b615['add'](_0x44687c),_0x5dd44e[_0x2f58('0x58')](_0x44687c);}[_0x2f58('0x3b')](_0x17eb75){const _0x3f7789=this['editor']['plugins'][_0x2f58('0x19')](_0x2f58('0x72')),_0x12fe5d=this['_suggestionToController'][_0x2f58('0x19')](_0x17eb75),_0x1d6c09=_0x12fe5d[_0x2f58('0x13')],_0xebf044=_0x3f7789['getByInnerView'](_0x1d6c09);_0xebf044&&_0x3f7789[_0x2f58('0xe')](_0xebf044),this[_0x2f58('0x49')][_0x2f58('0x5e')](_0x17eb75),this['_viewToController'][_0x2f58('0x5e')](_0x1d6c09),_0x12fe5d[_0x2f58('0x4b')]();}[_0x2f58('0x24')](_0x5676f9){if(!_0x5676f9['isInContent']||!this['_suggestionToController'][_0x2f58('0x62')](_0x5676f9))return;const _0x1a8f51=this[_0x2f58('0x1')][_0x2f58('0x11')][_0x2f58('0x19')](_0x2f58('0x9')),_0x32e70d=this['_suggestionToController'][_0x2f58('0x19')](_0x5676f9),_0x114916=_0x5676f9[_0x2f58('0x42')]();_0x32e70d[_0x2f58('0x13')][_0x2f58('0x1a')]=_0x1a8f51[_0x2f58('0x20')][_0x2f58('0x29')](_0x114916);}['destroy'](){for(const _0xa72cea of this[_0x2f58('0x49')][_0x2f58('0x6a')]())this[_0x2f58('0x3b')](_0xa72cea);for(const _0x4b00fb of this[_0x2f58('0x73')][_0x2f58('0x36')]())_0x4b00fb[_0x2f58('0x23')][_0x2f58('0x4b')]();super[_0x2f58('0x4b')]();}}